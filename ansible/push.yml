- name: Deploy full stack app
  hosts: web
  become: yes
#
  tasks:
#    - name: Видалити можливі старі версії Docker
#      shell: |
#        apt-get remove -y docker docker-engine docker.io containerd runc || true
#        apt-get autoremove -y
#        apt-get update -y
#
#    - name: Встановити базові залежності
#      apt:
#        name:
#          - git
#          - ca-certificates
#          - curl
#          - gnupg
#          - lsb-release
#        state: present
#        update_cache: yes
#
#    - name: Додати офіційний Docker GPG ключ
#      shell: |
#        install -m 0755 -d /etc/apt/keyrings
#        curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
#        chmod a+r /etc/apt/keyrings/docker.asc
#      args:
#        creates: /etc/apt/keyrings/docker.asc
#
#    - name: Додати Docker репозиторій
#      shell: |
#        echo \
#          "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] \
#          https://download.docker.com/linux/ubuntu \
#          $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
#        apt-get update -y
#      args:
#        creates: /etc/apt/sources.list.d/docker.list
#
#    - name: Встановити Docker і Docker Compose
#      apt:
#        name:
#          - docker-ce
#          - docker-ce-cli
#          - containerd.io
#          - docker-buildx-plugin
#          - docker-compose-plugin
#        state: present
#        update_cache: yes
#
#    - name: Додати користувача ubuntu до групи docker
#      user:
#        name: ubuntu
#        groups: docker
#        append: yes
#
#    - name: Створити директорії для додатка
#      file:
#        path: "{{ item }}"
#        state: directory
#        owner: ubuntu
#        group: ubuntu
#        mode: '0755'
#      loop:
#        - /opt/app
#        - /opt/app/frontend
#        - /opt/app/backend

    - name: Скопіювати docker-compose.yml
      copy:
        dest: /opt/app/docker-compose.yml
        owner: ubuntu
        group: ubuntu
        content: "{{ lookup('file', 'docker-compose.yml') }}"

    - name: Скопіювати nginx.conf
      copy:
        dest: /opt/app/nginx.conf
        owner: ubuntu
        group: ubuntu
        content: "{{ lookup('file', 'nginx.conf') }}"
